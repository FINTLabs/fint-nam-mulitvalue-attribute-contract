package si.genlan.nam.idp

import com.novell.nidp.common.authority.UserAuthority
import org.w3c.dom.Document
import org.w3c.dom.Element
import org.w3c.dom.NodeList
import spock.lang.Specification

import javax.xml.xpath.XPathConstants
import javax.xml.xpath.XPathFactory

class SamlResponseServiceSpec extends Specification {

    private SamlResponseService samlResponseService;

    void setup() {
        samlResponseService = new SamlResponseService(new Properties());
    }

    def "Saml response should be decoded"() {
        given:
        def samlResponse = "PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIERlc3RpbmF0aW9uPSJodHRwczovL1NlYmFzdGlhbi1OQU0uZ2VubGFuLnNpL25pZHAvc2FtbDIvc3Bhc3NlcnRpb25fY29uc3VtZXIiIElEPSJpZEJsbEFtdENmRmJ0cnB1OTRyZTJIdEtzaHFQayIgSW5SZXNwb25zZVRvPSJpZHExM3phUWFNdnZEUmdvUGoxemJYbVZieGpxOCIgSXNzdWVJbnN0YW50PSIyMDIxLTExLTAyVDEyOjI2OjQxWiIgVmVyc2lvbj0iMi4wIj48c2FtbDpJc3N1ZXI+aHR0cHM6Ly9pZHAuZ2VubGFuLnNpL25pZHAvc2FtbDIvbWV0YWRhdGE8L3NhbWw6SXNzdWVyPjxzYW1scDpTdGF0dXM+PHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPjwvc2FtbHA6U3RhdHVzPjxzYW1sOkFzc2VydGlvbiBJRD0iaWR0LUZjaTN4QXEydnpzZEZyVk8wb29hMU9qaVkiIElzc3VlSW5zdGFudD0iMjAyMS0xMS0wMlQxMjoyNjo0MVoiIFZlcnNpb249IjIuMCI+PHNhbWw6SXNzdWVyPmh0dHBzOi8vaWRwLmdlbmxhbi5zaS9uaWRwL3NhbWwyL21ldGFkYXRhPC9zYW1sOklzc3Vlcj48ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj4KPGRzOlNpZ25lZEluZm8+CjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+CjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNyc2Etc2hhMjU2Ii8+CjxkczpSZWZlcmVuY2UgVVJJPSIjaWR0LUZjaTN4QXEydnpzZEZyVk8wb29hMU9qaVkiPgo8ZHM6VHJhbnNmb3Jtcz4KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+CjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KPC9kczpUcmFuc2Zvcm1zPgo8ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+CjxkczpEaWdlc3RWYWx1ZT5yQTM4R3hCa3kwc08wWkNkU283Tm9HWXQrYktRT3pERlg0cjkrQzM5RHpnPTwvZHM6RGlnZXN0VmFsdWU+CjwvZHM6UmVmZXJlbmNlPgo8L2RzOlNpZ25lZEluZm8+CjxkczpTaWduYXR1cmVWYWx1ZT4KUTl0djZCNEdwcmhaYlNnQ0dhMTZyVmJHMzlNK0grVFNWNzBDdVMzMVhta2djQXc4NWx2bjIvQ0w0bjhhMk9HVFFOMVZrbEZvalQ1RApDWHpGYWZlRzhPZXN2UEl1SkNTaUJxd0pxZG9FTEZqNDdCZ1hZam9NZmFKdEpPaUo4enM0Uk5abzZvcHB6ZkIzbituNUdhaWUrSDhkClRiVVFFcTZuN2g2YlZSdFlGaktMb3FhditHWDhIWkxUWVhIZkg2WW5FL2NZSnV0MytFbU9BMG0wazU4dm4yempuUXFSbG9QVUhTcVUKZFFPQnF6NzIyRmc1UzNmUTVEZlZjZXl6U3JySzFTdmtXbUk1TXBKY2krcU05dVRvRmw1UDV1M01GYng3akU4cVpNMEZpTVZVZmMvNgpHczBWdkNvRXRCcldvNy9iSE01NEowRjEyZU9qQkk2WHpacGJHQT09CjwvZHM6U2lnbmF0dXJlVmFsdWU+CjxkczpLZXlJbmZvPgo8ZHM6WDUwOURhdGE+CjxkczpYNTA5Q2VydGlmaWNhdGU+Ck1JSUdNRENDQlJpZ0F3SUJBZ0lJWWdtb3l0d1Fva1F3RFFZSktvWklodmNOQVFFTEJRQXdnYlF4Q3pBSkJnTlZCQVlUQWxWVE1SQXcKRGdZRFZRUUlFd2RCY21sNmIyNWhNUk13RVFZRFZRUUhFd3BUWTI5MGRITmtZV3hsTVJvd0dBWURWUVFLRXhGSGIwUmhaR1I1TG1OdgpiU3dnU1c1akxqRXRNQ3NHQTFVRUN4TWthSFIwY0RvdkwyTmxjblJ6TG1kdlpHRmtaSGt1WTI5dEwzSmxjRzl6YVhSdmNua3ZNVE13Ck1RWURWUVFERXlwSGJ5QkVZV1JrZVNCVFpXTjFjbVVnUTJWeWRHbG1hV05oZEdVZ1FYVjBhRzl5YVhSNUlDMGdSekl3SGhjTk1qQXgKTURFMU1Ea3pNREkzV2hjTk1qRXhNVEUyTURrek1ESTNXakE1TVNFd0h3WURWUVFMRXhoRWIyMWhhVzRnUTI5dWRISnZiQ0JXWVd4cApaR0YwWldReEZEQVNCZ05WQkFNTUN5b3VaMlZ1YkdGdUxuTnBNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDCkFRRUE4S29DMHgrMDQ3TkQzU245Y0cvcHYvN1kzaGpGTGozdHhELzd2Y2tHSGd2anVsNS9VbVI2MCtNMyttTHBzSFVzRWVFckNHUkcKMU1HRmxVc1ZxeEI0U0JKWGpxRURZL1lnMHorcnlUeVhZQzM2VzAyVEp2d0g1MHV3MUhMVDV1ZU5JSHo3Q0tRKzg5SGFLVzdrRnBhdApmQXE5M3RRUEdpMVhaSGJNRVBBNGNYamYyV21yNzJiMjJNV2UwKzVnS3J2NzhCbUZib2MwbHJGajhMbFpMbG9seGo3NG14ekdPeXozCkU3c21abVA2dzlsS2lVRmJpbXVOeUNVUlJFMXZoN1poUUxmb3lVbkN4c2pOdXQvVUZ6VkdkendYZUMxRnNwRWpnNkhSWnhzNG5hZDgKYUV3TUhjSzgxbkQ0VzE0TStya0NnbHBGdWlOYjFUUEFTdVZGeGxvNjFRSURBUUFCbzRJQ3ZqQ0NBcm93REFZRFZSMFRBUUgvQkFJdwpBREFkQmdOVkhTVUVGakFVQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0RnWURWUjBQQVFIL0JBUURBZ1dnTURnR0ExVWRId1F4Ck1DOHdMYUFyb0NtR0oyaDBkSEE2THk5amNtd3VaMjlrWVdSa2VTNWpiMjB2WjJScFp6SnpNUzB5TXpneExtTnliREJkQmdOVkhTQUUKVmpCVU1FZ0dDMkNHU0FHRy9XMEJCeGNCTURrd053WUlLd1lCQlFVSEFnRVdLMmgwZEhBNkx5OWpaWEowYVdacFkyRjBaWE11WjI5awpZV1JrZVM1amIyMHZjbVZ3YjNOcGRHOXllUzh3Q0FZR1o0RU1BUUlCTUhZR0NDc0dBUVVGQndFQkJHb3dhREFrQmdnckJnRUZCUWN3CkFZWVlhSFIwY0RvdkwyOWpjM0F1WjI5a1lXUmtlUzVqYjIwdk1FQUdDQ3NHQVFVRkJ6QUNoalJvZEhSd09pOHZZMlZ5ZEdsbWFXTmgKZEdWekxtZHZaR0ZrWkhrdVkyOXRMM0psY0c5emFYUnZjbmt2WjJScFp6SXVZM0owTUI4R0ExVWRJd1FZTUJhQUZFREN2U2VPekRTRApNS0l6MS90c3MvQzBMSURPTUNFR0ExVWRFUVFhTUJpQ0N5b3VaMlZ1YkdGdUxuTnBnZ2xuWlc1c1lXNHVjMmt3SFFZRFZSME9CQllFCkZFUjFVRC9PQ0dGaklCaTdiRUZnVG82ZWdnQ0NNSUlCQlFZS0t3WUJCQUhXZVFJRUFnU0I5Z1NCOHdEeEFIY0E5bHlVTDlGM01DSVUKVkJnSU1KUldqdU5ORXhrenY5OE1MeUFMekU3eFpPTUFBQUYxSzVpdzFRQUFCQU1BU0RCR0FpRUFqT1pBRDVwRVFBVnJJb2JNTks5MQp0ZjE3a1ZjMG5UR3owT3plK0h0WFB1MENJUUMwRWtIckliWU85d2pUanF5dERYb0ROK0M3WmpUVnArbGErc1BKTUQ1bnZnQjJBRnpjClE1TCs1cXRGUkxGZW10Ulc1aEEzKzlYNlI5eWhjNVN5WHViMnh3N0tBQUFCZFN1WXNpNEFBQVFEQUVjd1JRSWhBTUJDRUZ2OWtQMEwKVWxrQTVJbFBWU1VoTGFEU3JPNTZIR1JLUEpUQTYxV0NBaUI4bU50Zk5MMWtlTFZsaDRSVnNpbHlzRU9LTzVhcTI5ekxnWXptVU9vYQpQVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBU0pEdHVSZE5jQWw4S1N2Sno1SWRNSC8xeng4clJybW44L2swazRscVBKckgrSWpRCjVGcVA2OUNaNXdVQTBCc0paU3RhWDROY21DcDE2azJrdGM0d09RRitzMFlxTCs0dCtLeXpHNnNyTWhQeCtLREQ5WmRYTUZQVFhZTUYKYVU0d0ZmcmFIcnBHUDNnQ3dOWm5laFNtQzFJUHd1am9jOGlCQWI0NzlCMHNjQXZLSGJNMHVVSEFBbXJ0WDI4d28xcjYzRllBd3Z6ZQpweThVSksveStxZlpOaVhQeTBGVkxyMnpYTEhYS0pLNVJFaDdmbE5SdjdsNHlLM1M2N2IvT2ZTSmJEUkFtVE1kUWRzY0lBNVhscnZ2CjZnd0lxOUttNW9tTzkvQThhZnhVME5hRHVBOStpa3hLdEh2b2NIR2JzSzh1OUYxSkoxcDVwZWRkZXcyYmJiSnYyQT09CjwvZHM6WDUwOUNlcnRpZmljYXRlPgo8L2RzOlg1MDlEYXRhPgo8L2RzOktleUluZm8+CjwvZHM6U2lnbmF0dXJlPjxzYW1sOlN1YmplY3Q+PHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50IiBOYW1lUXVhbGlmaWVyPSJodHRwczovL2lkcC5nZW5sYW4uc2kvbmlkcC9zYW1sMi9tZXRhZGF0YSIgU1BOYW1lUXVhbGlmaWVyPSJodHRwczovL1NlYmFzdGlhbi1OQU0uZ2VubGFuLnNpL25pZHAvc2FtbDIvbWV0YWRhdGEiPldoN2VhZjBYcVo1WFFEVm1HVTQxYmhWR01tWWFRRE50S2tNR3h3PT08L3NhbWw6TmFtZUlEPjxzYW1sOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBJblJlc3BvbnNlVG89ImlkcTEzemFRYU12dkRSZ29QajF6YlhtVmJ4anE4IiBOb3RPbk9yQWZ0ZXI9IjIwMjEtMTEtMDJUMTI6MzE6NDFaIiBSZWNpcGllbnQ9Imh0dHBzOi8vU2ViYXN0aWFuLU5BTS5nZW5sYW4uc2kvbmlkcC9zYW1sMi9zcGFzc2VydGlvbl9jb25zdW1lciIvPjwvc2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uPjwvc2FtbDpTdWJqZWN0PjxzYW1sOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDIxLTExLTAyVDEyOjIxOjQxWiIgTm90T25PckFmdGVyPSIyMDIxLTExLTAyVDEyOjMxOjQxWiI+PHNhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDpBdWRpZW5jZT5odHRwczovL1NlYmFzdGlhbi1OQU0uZ2VubGFuLnNpL25pZHAvc2FtbDIvbWV0YWRhdGE8L3NhbWw6QXVkaWVuY2U+PC9zYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+PC9zYW1sOkNvbmRpdGlvbnM+PHNhbWw6QXV0aG5TdGF0ZW1lbnQgQXV0aG5JbnN0YW50PSIyMDIxLTExLTAyVDEwOjA4OjIxWiIgU2Vzc2lvbkluZGV4PSJpZHQtRmNpM3hBcTJ2enNkRnJWTzBvb2ExT2ppWSI+PHNhbWw6QXV0aG5Db250ZXh0PjxzYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPmh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9hdXRoZW50aWNhdGlvbm1ldGhvZC9hYTwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48c2FtbDpBdXRobkNvbnRleHREZWNsUmVmPmh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9hdXRoZW50aWNhdGlvbm1ldGhvZC9hYTwvc2FtbDpBdXRobkNvbnRleHREZWNsUmVmPjwvc2FtbDpBdXRobkNvbnRleHQ+PC9zYW1sOkF1dGhuU3RhdGVtZW50PjxzYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBOYW1lPSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL2lkZW50aXR5L2NsYWltcy9kaXNwbGF5bmFtZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+U2ViYXN0aWFuIE5vdmFrPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgTmFtZT0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvcm9sZXMiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPmdlbmxhbi1yb2xlMTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5nZW5sYW4tcm9sZTI8L3NhbWw6QXR0cmlidXRlVmFsdWU+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+Z2VubGFuLXJvbGUzPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgTmFtZT0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS9pZGVudGl0eS9jbGFpbXMvb2JqZWN0aWRlbnRpZmllciIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+OWY5ODUwY2Y5ZjRjZjk0NGIwNmI5Zjk4NTBjZjlmNGM8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9naXZlbm5hbWUiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPlNlYmFzdGlhbjwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWUiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPlNlYmFzdGlhbkBnZW5sYW4uc2k8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9zdXJuYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5Ob3Zhazwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL2VtYWlsYWRkcmVzcyIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+c2ViYXN0aWFuLm5vdmFrQGdlbmxhbi5zaTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjwvc2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sOkFzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPg=="
        def xPath = XPathFactory.newInstance().newXPath();

        when:
        def document = samlResponseService.decodeSAMLResponse(samlResponse)


        then:
        document
        //displayNameClainValue == "Ola Norman"
        //print(displayNameClainValue);
    }

    def "Add Saml to List"() {
        given:
        def samlResponse = "PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIERlc3RpbmF0aW9uPSJodHRwczovL1NlYmFzdGlhbi1OQU0uZ2VubGFuLnNpL25pZHAvc2FtbDIvc3Bhc3NlcnRpb25fY29uc3VtZXIiIElEPSJpZEJsbEFtdENmRmJ0cnB1OTRyZTJIdEtzaHFQayIgSW5SZXNwb25zZVRvPSJpZHExM3phUWFNdnZEUmdvUGoxemJYbVZieGpxOCIgSXNzdWVJbnN0YW50PSIyMDIxLTExLTAyVDEyOjI2OjQxWiIgVmVyc2lvbj0iMi4wIj48c2FtbDpJc3N1ZXI+aHR0cHM6Ly9pZHAuZ2VubGFuLnNpL25pZHAvc2FtbDIvbWV0YWRhdGE8L3NhbWw6SXNzdWVyPjxzYW1scDpTdGF0dXM+PHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPjwvc2FtbHA6U3RhdHVzPjxzYW1sOkFzc2VydGlvbiBJRD0iaWR0LUZjaTN4QXEydnpzZEZyVk8wb29hMU9qaVkiIElzc3VlSW5zdGFudD0iMjAyMS0xMS0wMlQxMjoyNjo0MVoiIFZlcnNpb249IjIuMCI+PHNhbWw6SXNzdWVyPmh0dHBzOi8vaWRwLmdlbmxhbi5zaS9uaWRwL3NhbWwyL21ldGFkYXRhPC9zYW1sOklzc3Vlcj48ZHM6U2lnbmF0dXJlIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj4KPGRzOlNpZ25lZEluZm8+CjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+CjxkczpTaWduYXR1cmVNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNyc2Etc2hhMjU2Ii8+CjxkczpSZWZlcmVuY2UgVVJJPSIjaWR0LUZjaTN4QXEydnpzZEZyVk8wb29hMU9qaVkiPgo8ZHM6VHJhbnNmb3Jtcz4KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+CjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KPC9kczpUcmFuc2Zvcm1zPgo8ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+CjxkczpEaWdlc3RWYWx1ZT5yQTM4R3hCa3kwc08wWkNkU283Tm9HWXQrYktRT3pERlg0cjkrQzM5RHpnPTwvZHM6RGlnZXN0VmFsdWU+CjwvZHM6UmVmZXJlbmNlPgo8L2RzOlNpZ25lZEluZm8+CjxkczpTaWduYXR1cmVWYWx1ZT4KUTl0djZCNEdwcmhaYlNnQ0dhMTZyVmJHMzlNK0grVFNWNzBDdVMzMVhta2djQXc4NWx2bjIvQ0w0bjhhMk9HVFFOMVZrbEZvalQ1RApDWHpGYWZlRzhPZXN2UEl1SkNTaUJxd0pxZG9FTEZqNDdCZ1hZam9NZmFKdEpPaUo4enM0Uk5abzZvcHB6ZkIzbituNUdhaWUrSDhkClRiVVFFcTZuN2g2YlZSdFlGaktMb3FhditHWDhIWkxUWVhIZkg2WW5FL2NZSnV0MytFbU9BMG0wazU4dm4yempuUXFSbG9QVUhTcVUKZFFPQnF6NzIyRmc1UzNmUTVEZlZjZXl6U3JySzFTdmtXbUk1TXBKY2krcU05dVRvRmw1UDV1M01GYng3akU4cVpNMEZpTVZVZmMvNgpHczBWdkNvRXRCcldvNy9iSE01NEowRjEyZU9qQkk2WHpacGJHQT09CjwvZHM6U2lnbmF0dXJlVmFsdWU+CjxkczpLZXlJbmZvPgo8ZHM6WDUwOURhdGE+CjxkczpYNTA5Q2VydGlmaWNhdGU+Ck1JSUdNRENDQlJpZ0F3SUJBZ0lJWWdtb3l0d1Fva1F3RFFZSktvWklodmNOQVFFTEJRQXdnYlF4Q3pBSkJnTlZCQVlUQWxWVE1SQXcKRGdZRFZRUUlFd2RCY21sNmIyNWhNUk13RVFZRFZRUUhFd3BUWTI5MGRITmtZV3hsTVJvd0dBWURWUVFLRXhGSGIwUmhaR1I1TG1OdgpiU3dnU1c1akxqRXRNQ3NHQTFVRUN4TWthSFIwY0RvdkwyTmxjblJ6TG1kdlpHRmtaSGt1WTI5dEwzSmxjRzl6YVhSdmNua3ZNVE13Ck1RWURWUVFERXlwSGJ5QkVZV1JrZVNCVFpXTjFjbVVnUTJWeWRHbG1hV05oZEdVZ1FYVjBhRzl5YVhSNUlDMGdSekl3SGhjTk1qQXgKTURFMU1Ea3pNREkzV2hjTk1qRXhNVEUyTURrek1ESTNXakE1TVNFd0h3WURWUVFMRXhoRWIyMWhhVzRnUTI5dWRISnZiQ0JXWVd4cApaR0YwWldReEZEQVNCZ05WQkFNTUN5b3VaMlZ1YkdGdUxuTnBNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDCkFRRUE4S29DMHgrMDQ3TkQzU245Y0cvcHYvN1kzaGpGTGozdHhELzd2Y2tHSGd2anVsNS9VbVI2MCtNMyttTHBzSFVzRWVFckNHUkcKMU1HRmxVc1ZxeEI0U0JKWGpxRURZL1lnMHorcnlUeVhZQzM2VzAyVEp2d0g1MHV3MUhMVDV1ZU5JSHo3Q0tRKzg5SGFLVzdrRnBhdApmQXE5M3RRUEdpMVhaSGJNRVBBNGNYamYyV21yNzJiMjJNV2UwKzVnS3J2NzhCbUZib2MwbHJGajhMbFpMbG9seGo3NG14ekdPeXozCkU3c21abVA2dzlsS2lVRmJpbXVOeUNVUlJFMXZoN1poUUxmb3lVbkN4c2pOdXQvVUZ6VkdkendYZUMxRnNwRWpnNkhSWnhzNG5hZDgKYUV3TUhjSzgxbkQ0VzE0TStya0NnbHBGdWlOYjFUUEFTdVZGeGxvNjFRSURBUUFCbzRJQ3ZqQ0NBcm93REFZRFZSMFRBUUgvQkFJdwpBREFkQmdOVkhTVUVGakFVQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0RnWURWUjBQQVFIL0JBUURBZ1dnTURnR0ExVWRId1F4Ck1DOHdMYUFyb0NtR0oyaDBkSEE2THk5amNtd3VaMjlrWVdSa2VTNWpiMjB2WjJScFp6SnpNUzB5TXpneExtTnliREJkQmdOVkhTQUUKVmpCVU1FZ0dDMkNHU0FHRy9XMEJCeGNCTURrd053WUlLd1lCQlFVSEFnRVdLMmgwZEhBNkx5OWpaWEowYVdacFkyRjBaWE11WjI5awpZV1JrZVM1amIyMHZjbVZ3YjNOcGRHOXllUzh3Q0FZR1o0RU1BUUlCTUhZR0NDc0dBUVVGQndFQkJHb3dhREFrQmdnckJnRUZCUWN3CkFZWVlhSFIwY0RvdkwyOWpjM0F1WjI5a1lXUmtlUzVqYjIwdk1FQUdDQ3NHQVFVRkJ6QUNoalJvZEhSd09pOHZZMlZ5ZEdsbWFXTmgKZEdWekxtZHZaR0ZrWkhrdVkyOXRMM0psY0c5emFYUnZjbmt2WjJScFp6SXVZM0owTUI4R0ExVWRJd1FZTUJhQUZFREN2U2VPekRTRApNS0l6MS90c3MvQzBMSURPTUNFR0ExVWRFUVFhTUJpQ0N5b3VaMlZ1YkdGdUxuTnBnZ2xuWlc1c1lXNHVjMmt3SFFZRFZSME9CQllFCkZFUjFVRC9PQ0dGaklCaTdiRUZnVG82ZWdnQ0NNSUlCQlFZS0t3WUJCQUhXZVFJRUFnU0I5Z1NCOHdEeEFIY0E5bHlVTDlGM01DSVUKVkJnSU1KUldqdU5ORXhrenY5OE1MeUFMekU3eFpPTUFBQUYxSzVpdzFRQUFCQU1BU0RCR0FpRUFqT1pBRDVwRVFBVnJJb2JNTks5MQp0ZjE3a1ZjMG5UR3owT3plK0h0WFB1MENJUUMwRWtIckliWU85d2pUanF5dERYb0ROK0M3WmpUVnArbGErc1BKTUQ1bnZnQjJBRnpjClE1TCs1cXRGUkxGZW10Ulc1aEEzKzlYNlI5eWhjNVN5WHViMnh3N0tBQUFCZFN1WXNpNEFBQVFEQUVjd1JRSWhBTUJDRUZ2OWtQMEwKVWxrQTVJbFBWU1VoTGFEU3JPNTZIR1JLUEpUQTYxV0NBaUI4bU50Zk5MMWtlTFZsaDRSVnNpbHlzRU9LTzVhcTI5ekxnWXptVU9vYQpQVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBU0pEdHVSZE5jQWw4S1N2Sno1SWRNSC8xeng4clJybW44L2swazRscVBKckgrSWpRCjVGcVA2OUNaNXdVQTBCc0paU3RhWDROY21DcDE2azJrdGM0d09RRitzMFlxTCs0dCtLeXpHNnNyTWhQeCtLREQ5WmRYTUZQVFhZTUYKYVU0d0ZmcmFIcnBHUDNnQ3dOWm5laFNtQzFJUHd1am9jOGlCQWI0NzlCMHNjQXZLSGJNMHVVSEFBbXJ0WDI4d28xcjYzRllBd3Z6ZQpweThVSksveStxZlpOaVhQeTBGVkxyMnpYTEhYS0pLNVJFaDdmbE5SdjdsNHlLM1M2N2IvT2ZTSmJEUkFtVE1kUWRzY0lBNVhscnZ2CjZnd0lxOUttNW9tTzkvQThhZnhVME5hRHVBOStpa3hLdEh2b2NIR2JzSzh1OUYxSkoxcDVwZWRkZXcyYmJiSnYyQT09CjwvZHM6WDUwOUNlcnRpZmljYXRlPgo8L2RzOlg1MDlEYXRhPgo8L2RzOktleUluZm8+CjwvZHM6U2lnbmF0dXJlPjxzYW1sOlN1YmplY3Q+PHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50IiBOYW1lUXVhbGlmaWVyPSJodHRwczovL2lkcC5nZW5sYW4uc2kvbmlkcC9zYW1sMi9tZXRhZGF0YSIgU1BOYW1lUXVhbGlmaWVyPSJodHRwczovL1NlYmFzdGlhbi1OQU0uZ2VubGFuLnNpL25pZHAvc2FtbDIvbWV0YWRhdGEiPldoN2VhZjBYcVo1WFFEVm1HVTQxYmhWR01tWWFRRE50S2tNR3h3PT08L3NhbWw6TmFtZUlEPjxzYW1sOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBJblJlc3BvbnNlVG89ImlkcTEzemFRYU12dkRSZ29QajF6YlhtVmJ4anE4IiBOb3RPbk9yQWZ0ZXI9IjIwMjEtMTEtMDJUMTI6MzE6NDFaIiBSZWNpcGllbnQ9Imh0dHBzOi8vU2ViYXN0aWFuLU5BTS5nZW5sYW4uc2kvbmlkcC9zYW1sMi9zcGFzc2VydGlvbl9jb25zdW1lciIvPjwvc2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uPjwvc2FtbDpTdWJqZWN0PjxzYW1sOkNvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDIxLTExLTAyVDEyOjIxOjQxWiIgTm90T25PckFmdGVyPSIyMDIxLTExLTAyVDEyOjMxOjQxWiI+PHNhbWw6QXVkaWVuY2VSZXN0cmljdGlvbj48c2FtbDpBdWRpZW5jZT5odHRwczovL1NlYmFzdGlhbi1OQU0uZ2VubGFuLnNpL25pZHAvc2FtbDIvbWV0YWRhdGE8L3NhbWw6QXVkaWVuY2U+PC9zYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+PC9zYW1sOkNvbmRpdGlvbnM+PHNhbWw6QXV0aG5TdGF0ZW1lbnQgQXV0aG5JbnN0YW50PSIyMDIxLTExLTAyVDEwOjA4OjIxWiIgU2Vzc2lvbkluZGV4PSJpZHQtRmNpM3hBcTJ2enNkRnJWTzBvb2ExT2ppWSI+PHNhbWw6QXV0aG5Db250ZXh0PjxzYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPmh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9hdXRoZW50aWNhdGlvbm1ldGhvZC9hYTwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48c2FtbDpBdXRobkNvbnRleHREZWNsUmVmPmh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9hdXRoZW50aWNhdGlvbm1ldGhvZC9hYTwvc2FtbDpBdXRobkNvbnRleHREZWNsUmVmPjwvc2FtbDpBdXRobkNvbnRleHQ+PC9zYW1sOkF1dGhuU3RhdGVtZW50PjxzYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBOYW1lPSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL2lkZW50aXR5L2NsYWltcy9kaXNwbGF5bmFtZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+U2ViYXN0aWFuIE5vdmFrPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgTmFtZT0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvcm9sZXMiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPmdlbmxhbi1yb2xlMTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5nZW5sYW4tcm9sZTI8L3NhbWw6QXR0cmlidXRlVmFsdWU+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+Z2VubGFuLXJvbGUzPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PHNhbWw6QXR0cmlidXRlIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgTmFtZT0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS9pZGVudGl0eS9jbGFpbXMvb2JqZWN0aWRlbnRpZmllciIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+OWY5ODUwY2Y5ZjRjZjk0NGIwNmI5Zjk4NTBjZjlmNGM8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9naXZlbm5hbWUiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPlNlYmFzdGlhbjwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWUiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dW5zcGVjaWZpZWQiPjxzYW1sOkF0dHJpYnV0ZVZhbHVlIHhzaTp0eXBlPSJ4czpzdHJpbmciPlNlYmFzdGlhbkBnZW5sYW4uc2k8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9zdXJuYW1lIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OnVuc3BlY2lmaWVkIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4c2k6dHlwZT0ieHM6c3RyaW5nIj5Ob3Zhazwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjxzYW1sOkF0dHJpYnV0ZSB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiIE5hbWU9Imh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL2VtYWlsYWRkcmVzcyIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDp1bnNwZWNpZmllZCI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeHNpOnR5cGU9InhzOnN0cmluZyI+c2ViYXN0aWFuLm5vdmFrQGdlbmxhbi5zaTwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT48L3NhbWw6QXR0cmlidXRlPjwvc2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PC9zYW1sOkFzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPg=="
        def xPath = XPathFactory.newInstance().newXPath();
        def matchingAttribute = "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname";
        def NodeList nodes = null

        when:
        def document = samlResponseService.decodeSAMLResponse(samlResponse)
        def displayNameClainValue = xPath
                .compile("//Attribute[@Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/roles\"]")
                .evaluate(document, XPathConstants.STRING)
        print(displayNameClainValue);
        print(document.getChildNodes().getLength());

        nodes = (NodeList) xPath.compile("//Attribute/*").evaluate(document, XPathConstants.NODESET)
        print("\nNodeLength " + nodes.getLength())
        for(int i = 0; i < nodes.getLength(); i++)
        {

            Element e = (Element) nodes.item(i).getParentNode()
            String attributeValue = nodes.item(i).getTextContent()
            String attributeName = e.getAttribute("Name");

            print("\nNodeName: "+ attributeName + " Attribute Value: " + attributeValue);

            if(attributeName.equals(matchingAttribute)) {
                //UpdateUserStoreBySamlResponseContract.samlRequestVariableList.getSamlRequests().add(new SamlRequest(attributeValue, samlResponse));
                print("Putting in");
                break;
            }
            print("\nend " + i);
        }
        //def updateUserStore = new UpdateUserStoreBySamlResponseContract();
        then:
        print("done")
    }
}
